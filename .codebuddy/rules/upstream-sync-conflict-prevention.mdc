---
description: ä¸Šæ¸¸åŒæ­¥é˜²å†²çªæ¶æ„è§„èŒƒã€‚åœ¨æ–°å¢/ä¿®æ”¹ extensionsã€uiã€æµ‹è¯•æ–‡ä»¶æ—¶è§¦å‘ï¼Œç¡®ä¿ sync-upstream.sh åˆå¹¶æ—¶å†²çªèŒƒå›´é™åˆ¶åœ¨å¯¼å…¥è¡Œçº§åˆ«ã€‚
alwaysApply: true
globs: extensions/**/*,ui/**/*,src/**/*.test.ts
---

# ä¸Šæ¸¸åŒæ­¥é˜²å†²çªæ¶æ„è§„èŒƒ

> **ç›®æ ‡**ï¼šæ¯æ¬¡æ‰§è¡Œ `private/scripts/sync-upstream.sh` åˆå¹¶ä¸Šæ¸¸æ—¶ï¼Œå†²çª**æœ€å¤šåªå‡ºç°åœ¨ import/export è¡Œ**ï¼Œä¸æ¶‰åŠä¸šåŠ¡ä»£ç å†²çªã€‚

## ä¸€ã€æ ¸å¿ƒåŸåˆ™

å€Ÿé‰´ä¸šç•ŒæˆåŠŸçš„ fork ç»´æŠ¤ç­–ç•¥ï¼ˆBrave å¯¹ Chromium çš„ patch-overlay æ¨¡å¼ã€VSCodium å¯¹ VSCode çš„ product.json æ›¿æ¢ã€Grafana çš„ plugin extension point æ¨¡å¼ï¼‰ï¼š

1. **Overlayï¼Œä¸ Inline**ï¼šç§æœ‰åŠŸèƒ½é€šè¿‡**æ–°å¢æ–‡ä»¶**å®ç°ï¼Œè€Œéä¿®æ”¹ä¸Šæ¸¸å·²æœ‰æ–‡ä»¶
2. **å¶å­æ¨¡å—éš”ç¦»**ï¼šç§æœ‰ä»£ç åªå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ï¼ˆè¢«å¼•ç”¨æ–¹ï¼‰ï¼Œä¸ä¿®æ”¹è¢«å¤šæ–¹ä¾èµ–çš„çƒ­ç‚¹æ–‡ä»¶
3. **å•ç‚¹æ³¨å†Œ**ï¼šåœ¨é›†ä¸­å¼æ³¨å†Œè¡¨ä¸­ï¼Œç§æœ‰æ‰©å±•ç”¨æ˜ç¡®çš„æ³¨é‡Šå—åˆ†éš”ï¼Œå§‹ç»ˆè¿½åŠ åœ¨æœ«å°¾
4. **åŒ…åå¯¼å…¥**ï¼šè·¨è¾¹ç•Œå¼•ç”¨èµ° `@openclaw/*` æˆ– `openclaw/plugin-sdk` åŒ…åï¼Œä¸èµ°ç›¸å¯¹è·¯å¾„

## äºŒã€æ–‡ä»¶å†²çªé£é™©åˆ†çº§ï¼ˆåŸºäºèµ°æŸ¥ç»“è®ºï¼‰

### ğŸ”´ æé«˜é£é™©â€”â€”åˆå¹¶ç£é“ï¼ˆMerge Magnetsï¼‰

| æ–‡ä»¶ | é£é™©åŸå›  |
|------|----------|
| `ui/src/ui/tab-registry.ts` | æ‰€æœ‰ tab å®šä¹‰é›†ä¸­çš„æœ‰åºæ•°ç»„ï¼›ä¸Šæ¸¸å’Œ fork éƒ½ä¼šä¿®æ”¹ |
| `ui/src/ui/app.ts` | ä¸»ç»„ä»¶ï¼Œ50+ è¡Œ import + æ‰€æœ‰ `@state` å£°æ˜ |
| `ui/src/ui/app-view-state.ts` | å…¨å±€è§†å›¾çŠ¶æ€ç±»å‹ï¼Œæ–°å¢ tab/åŠŸèƒ½éƒ½è¦æ‰©å±• |
| `extensions/web3-core/src/index.ts` | 150+ è¡Œ import + å¤§é‡ gateway method æ³¨å†Œ |
| `extensions/market-core/src/market/handlers/index.ts` | 12 ä¸ªå­æ¨¡å—çš„ barrel re-export |

**æ“ä½œè§„åˆ™**ï¼š
- **ç¦æ­¢**åœ¨è¿™äº›æ–‡ä»¶ä¸­å†…è”ç§æœ‰ä¸šåŠ¡é€»è¾‘
- åªå…è®¸**è¿½åŠ  import è¡Œ**å’Œ**è¿½åŠ æ³¨å†Œè¡Œ**ï¼ˆåœ¨æ–‡ä»¶æœ«å°¾çš„ `// â”€â”€ private fork â”€â”€` åŒºåŸŸï¼‰
- å¦‚æœå¿…é¡»ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œå˜æ›´å¿…é¡»é™åˆ¶åœ¨**3 è¡Œä»¥å†…**

### ğŸŸ¡ ä¸­ç­‰é£é™©

| æ–‡ä»¶ | é£é™©åŸå›  |
|------|----------|
| `ui/src/ui/app-tab-loaders.ts` | è¢« 3 å¤„å¼•ç”¨ï¼Œä¸Šæ¸¸æ–°å¢ tab åŠ è½½é€»è¾‘ä¼šæ”¹æ­¤æ–‡ä»¶ |
| `ui/src/ui/navigation.ts` | `Tab` union type å®šä¹‰ï¼›æ–°å¢ tab éœ€æ‰©å±•ç±»å‹ |
| `ui/src/ui/app-render.ts` | ä¸»æ¸²æŸ“ç¼–æ’å™¨ï¼›å¸ƒå±€è°ƒæ•´ä¼šè§¦ç¢° |
| `ui/src/ui/app-render.helpers.ts` | å…±äº«æ¸²æŸ“è¾…åŠ©å‡½æ•° |
| `extensions/blockchain-adapter/src/` | è¢« agent-wallet å’Œ market-core çš„ 6 ä¸ªæ–‡ä»¶è·¨åŒ…ä¾èµ– |

**æ“ä½œè§„åˆ™**ï¼š
- å°½é‡é€šè¿‡**æ–°å¢ helper æ–‡ä»¶**è€Œéä¿®æ”¹è¿™äº›æ–‡ä»¶æ¥å®ç°éœ€æ±‚
- ä¿®æ”¹æ—¶ä½¿ç”¨**è¿½åŠ æ¨¡å¼**ï¼ˆåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼‰ï¼Œé¿å…åœ¨æ–‡ä»¶ä¸­é—´æ’å…¥

### ğŸŸ¢ ä½é£é™©â€”â€”å®‰å…¨å¶å­æ¨¡å—

| åŒºåŸŸ | åŸå›  |
|------|------|
| `ui/src/ui/app-render-*-tab.ts`ï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰ | å¶å­æ¸²æŸ“å™¨ï¼Œä»…è¢« `tab-registry.ts` å¼•ç”¨ |
| `ui/src/ui/views/*` | çº¯å±•ç¤ºç»„ä»¶ï¼Œè‡ªèº«ä¸å¼•ç”¨æ ¸å¿ƒæ¶æ„ |
| `ui/src/ui/controllers/*` | æ•°æ®æ“ä½œå±‚ï¼Œç‹¬ç«‹æ€§å¼º |
| `extensions/` ä¸­çš„å¶å­æ‰©å±• | 30+ ä¸ªç‹¬ç«‹æ‰©å±•ï¼Œä¸è¢«å¤–éƒ¨å¼•ç”¨ |
| æ‰€æœ‰ `*.test.ts` æ–‡ä»¶ | è‡ªåŒ…å«ï¼Œä¸è¢«å…¶ä»–æ–‡ä»¶å¯¼å…¥ |

**æ“ä½œè§„åˆ™**ï¼š
- **ä¼˜å…ˆåœ¨è¿™äº›åŒºåŸŸç¼–å†™ç§æœ‰åŠŸèƒ½**â€”â€”è¿™æ˜¯æœ€å®‰å…¨çš„æ‰©å±•ç‚¹
- æ–°å¢ tab æ—¶ï¼Œåˆ›å»º `app-render-<name>-tab.ts` å¶å­æ–‡ä»¶ï¼Œåªåœ¨ `tab-registry.ts` æœ«å°¾æ³¨å†Œ

## ä¸‰ã€æ‰©å±•ï¼ˆextensionsï¼‰é˜²å†²çªè§„èŒƒ

### 3.1 æ–°å¢æ‰©å±•

- **æ–°æ‰©å±• = æ–°ç›®å½•**ï¼š`extensions/<name>/`ï¼Œå®Œå…¨ç‹¬ç«‹ï¼Œé›¶å†²çªé£é™©
- å…¥å£æ¨¡å¼ç»Ÿä¸€ï¼šç®€å•æ’ä»¶ç”¨ `index.ts`ï¼›å¤æ‚æ’ä»¶ç”¨ `src/index.ts`
- é€šè¿‡ `openclaw/plugin-sdk` å¯¼å…¥ç±»å‹ï¼Œä¸èµ° `../../src/` ç›¸å¯¹è·¯å¾„

### 3.2 è·¨æ‰©å±•å¼•ç”¨

- **å¿…é¡»**é€šè¿‡åŒ…å `@openclaw/<name>` å¼•ç”¨å…¶ä»–æ‰©å±•ï¼Œ**ç¦æ­¢**ç›¸å¯¹è·¯å¾„è·¨ `extensions/` è¾¹ç•Œ
- è·¨åŒ…ä¾èµ–é“¾ï¼š`blockchain-adapter` â†’ `agent-wallet` / `market-core` â†’ `web3-core`
  - ä¿®æ”¹ `blockchain-adapter` çš„å¯¼å‡ºæ¥å£æ—¶ï¼Œå¿…é¡»åŒæ­¥æ£€æŸ¥ä¸‹æ¸¸ 6 ä¸ªæ–‡ä»¶

### 3.3 Barrel re-export æ–‡ä»¶ï¼ˆå¦‚ `handlers/index.ts`ï¼‰

- Barrel æ–‡ä»¶**åªåšå¯¼å‡ºï¼Œä¸å«é€»è¾‘**
- æ–°å¢ handler æ—¶ï¼šå…ˆåˆ›å»º `handlers/<name>.ts` å¶å­æ–‡ä»¶ï¼Œå†åœ¨ barrel æœ«å°¾è¿½åŠ ä¸€è¡Œ `export`
- ç§æœ‰ fork çš„ handler å¯¼å‡ºç»Ÿä¸€æ”¾åœ¨ `// â”€â”€ private fork handlers â”€â”€` æ³¨é‡Šå—ä¹‹å

### 3.4 web3-core ç‰¹æ®Šæ³¨æ„

- `web3-core` æ˜¯å”¯ä¸€å­˜åœ¨é«˜é£é™©è·¨è¾¹ç•Œä¾èµ–çš„æ‰©å±•
- 6 ä¸ªæµ‹è¯•æ–‡ä»¶é€šè¿‡ `vi.mock("../../../../src/gateway/call.ts")` ç›¸å¯¹è·¯å¾„ mock æ ¸å¿ƒä»£ç 
- **å¾…è§£è€¦**ï¼šè®¡åˆ’å°† `callGateway` å’Œ `loadConfig` ä¾èµ–é€šè¿‡ `openclaw/plugin-sdk` æš´éœ²çš„æ¥å£ä¼ é€’
- åœ¨è§£è€¦å®Œæˆå‰ï¼šä¿®æ”¹ `src/gateway/call.ts` æ¥å£æ—¶ï¼Œå¿…é¡»åŒæ­¥æ£€æŸ¥ `web3-core` çš„ 6 ä¸ªæµ‹è¯•æ–‡ä»¶

## å››ã€UI é˜²å†²çªè§„èŒƒ

### 4.1 Tab æ³¨å†Œæ¨¡å¼

```
æ–°å¢ Tab çš„æ ‡å‡†æµç¨‹ï¼ˆå†²çªæœ€å°åŒ–ï¼‰ï¼š
1. åˆ›å»º ui/src/ui/app-render-<name>-tab.ts   â† æ–°æ–‡ä»¶ï¼Œé›¶å†²çª
2. åˆ›å»º ui/src/ui/views/<name>.ts             â† æ–°æ–‡ä»¶ï¼Œé›¶å†²çª
3. åœ¨ tab-registry.ts æœ«å°¾è¿½åŠ æ³¨å†Œ             â† ä»…è¿½åŠ  import + æ•°ç»„é¡¹
4. åœ¨ navigation.ts çš„ Tab type è¿½åŠ ç±»å‹       â† ä»…è¿½åŠ  union member
5. åœ¨ app-view-state.ts è¿½åŠ çŠ¶æ€å­—æ®µ           â† ä»…è¿½åŠ å±æ€§
```

### 4.2 `tab-registry.ts` åˆ†åŒºçº¦å®š

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Upstream tabsï¼ˆä¸Šæ¸¸å®šä¹‰çš„ tabï¼Œä¸è¦åœ¨æ­¤åŒºåŸŸå†…æ’å…¥ç§æœ‰ tabï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{ id: "chat", ... },
{ id: "overview", ... },
// ... ä¸Šæ¸¸ tabs

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Private fork tabsï¼ˆç§æœ‰ fork è¿½åŠ çš„ tabï¼Œå§‹ç»ˆæ”¾åœ¨æœ€åï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// { id: "my-custom-tab", ... },
```

### 4.3 UI çŠ¶æ€æ‰©å±•

- æ‰©å±• `AppViewState` ç±»å‹æ—¶ï¼Œ**è¿½åŠ åœ¨ç±»å‹å®šä¹‰æœ«å°¾**
- æ–°å¢ `@state()` å±æ€§æ—¶ï¼Œ**è¿½åŠ åœ¨ `app.ts` çš„ state å£°æ˜åŒºæœ«å°¾**
- ç»ä¸ä¿®æ”¹å·²æœ‰å±æ€§çš„ç±»å‹ç­¾åï¼ˆé‚£æ˜¯ä¸Šæ¸¸çš„è´£ä»»ï¼‰

## äº”ã€æµ‹è¯•é˜²å†²çªè§„èŒƒ

### 5.1 æµ‹è¯•æ–‡ä»¶è‡ªåŒ…å«åŸåˆ™

- æµ‹è¯•æ–‡ä»¶**åªå¯¼å…¥åŒæ‰©å±•å†…éƒ¨æ¨¡å— + vitest + mock**
- **ç¦æ­¢**æµ‹è¯•æ–‡ä»¶è·¨æ‰©å±•è¾¹ç•Œå¯¼å…¥ï¼ˆ`web3-core` çš„ 6 ä¸ª `vi.mock` ä¾‹å¤–ï¼Œå·²çº³å…¥è§£è€¦è®¡åˆ’ï¼‰
- **ç¦æ­¢**æµ‹è¯•æ–‡ä»¶è¢«å…¶ä»–æ–‡ä»¶å¯¼å…¥ï¼ˆæµ‹è¯•æ˜¯å¶å­èŠ‚ç‚¹ï¼‰

### 5.2 å…±äº«æµ‹è¯•å·¥å…·

- æ ¸å¿ƒæµ‹è¯•å·¥å…·åœ¨ `src/test-utils/` å’Œ `src/test-helpers/`
- æ‰©å±•æµ‹è¯•**ä¸å¼•ç”¨**æ ¸å¿ƒæµ‹è¯•å·¥å…·ï¼ˆä¿æŒéš”ç¦»ï¼‰
- å¦‚éœ€å…±äº« mockï¼Œåœ¨æ‰©å±•å†…éƒ¨åˆ›å»º `__test-helpers__/` ç›®å½•

### 5.3 æ–°å¢æµ‹è¯•æ–‡ä»¶

- ä¸æºæ–‡ä»¶åŒç›®å½•æ”¾ç½®ï¼ˆå¦‚ `handlers/token-economy.ts` â†’ `handlers/token-economy.test.ts`ï¼‰
- æ–°å¢æµ‹è¯•æ–‡ä»¶ = æ–°æ–‡ä»¶ = é›¶å†²çªé£é™©

## å…­ã€Import è¡Œå†²çªå¤„ç† SOP

å½“ `sync-upstream.sh` æŠ¥å‘Šå†²çªä¸”å†²çª**ä»…é™äº import/export è¡Œ**æ—¶ï¼š

```bash
# 1. æŸ¥çœ‹å†²çªæ–‡ä»¶
git diff --name-only --diff-filter=U

# 2. å¯¹äº barrel/registry æ–‡ä»¶çš„ import å†²çªï¼šä¿ç•™åŒæ–¹çš„ importï¼Œå»é‡
#    ç­–ç•¥ï¼šæ¥å—ä¸Šæ¸¸ç‰ˆæœ¬ + æ‰‹åŠ¨è¿½åŠ ç§æœ‰ import
git checkout --theirs <file>
# ç„¶åæ‰‹åŠ¨åœ¨æœ«å°¾è¿½åŠ ç§æœ‰ fork çš„ import/export è¡Œ

# 3. å¯¹äº pnpm-lock.yamlï¼šsync-upstream.sh å·²è‡ªåŠ¨å¤„ç†

# 4. éªŒè¯
pnpm install && pnpm build && pnpm test
```

## ä¸ƒã€è‡ªæ£€æ¸…å•ï¼ˆæ¯æ¬¡æäº¤å‰ï¼‰

åœ¨ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶å‰ï¼Œå…ˆé—®è‡ªå·±ï¼š

- [ ] è¿™ä¸ªæ”¹åŠ¨èƒ½å¦é€šè¿‡**æ–°å¢æ–‡ä»¶**å®ç°ï¼Œè€Œä¸ä¿®æ”¹ä¸Šæ¸¸çƒ­ç‚¹æ–‡ä»¶ï¼Ÿ
- [ ] å¦‚æœå¿…é¡»ä¿®æ”¹çƒ­ç‚¹æ–‡ä»¶ï¼Œæ”¹åŠ¨æ˜¯å¦é™åˆ¶åœ¨**è¿½åŠ æ¨¡å¼**ï¼ˆæ–‡ä»¶æœ«å°¾ï¼‰ï¼Ÿ
- [ ] è·¨æ‰©å±•å¼•ç”¨æ˜¯å¦èµ°**åŒ…å**è€Œéç›¸å¯¹è·¯å¾„ï¼Ÿ
- [ ] æµ‹è¯•æ–‡ä»¶æ˜¯å¦**è‡ªåŒ…å«**ï¼ˆåªå¼•ç”¨åŒæ‰©å±•æ¨¡å—ï¼‰ï¼Ÿ
- [ ] `tab-registry.ts` çš„ä¿®æ”¹æ˜¯å¦åœ¨**ç§æœ‰åŒºåŸŸ**ï¼Ÿ

## å…«ã€å·²æ‰§è¡Œçš„ Overlay æ¨¡å¼ï¼ˆå‚è€ƒå®ç°ï¼‰

ä»¥ä¸‹ overlay æ–‡ä»¶å·²åˆ›å»ºï¼Œä½œä¸ºæœ¬è§„èŒƒçš„æ ‡å‡†å®ç°èŒƒä¾‹ï¼š

### 8.1 Core CLI å±‚

| ä¸Šæ¸¸æ–‡ä»¶ | Overlay æ–‡ä»¶ | è§£è€¦æ–¹å¼ |
|----------|-------------|----------|
| `src/gateway/method-scopes.ts` | `src/gateway/method-scopes-web3.ts` | 62 ä¸ª web3 method æå–åˆ° overlayï¼Œä¸»æ–‡ä»¶ç”¨ `...spread` åˆå¹¶ |
| `src/commands/status.scan.ts` | `src/commands/status-scan-web3.ts` | web3 çŠ¶æ€æ‰«æé€»è¾‘æå–ï¼Œä¸»æ–‡ä»¶å•è¡Œè°ƒç”¨ |
| `src/commands/status.command.ts` | `src/commands/status-command-web3.ts` | web3 é¢æ¿æ¸²æŸ“æå–ï¼Œä¸»æ–‡ä»¶å•è¡Œè°ƒç”¨ |
| `src/auto-reply/status.ts` | `src/auto-reply/status-featured-commands.ts` | `"web3-market"` ç¡¬ç¼–ç æå–ä¸ºå¯é…ç½® Set |
| `src/commands/share.ts` | `src/commands/share-provider-id.ts` | æ¶ˆé™¤å”¯ä¸€çš„ `src/` â†’ `extensions/` è·¨è¾¹ç•Œå¯¼å…¥ |

### 8.2 UI å±‚

| ä¸Šæ¸¸æ–‡ä»¶ | Overlay æ–‡ä»¶ | è§£è€¦æ–¹å¼ |
|----------|-------------|----------|
| `ui/src/ui/types.ts` | `ui/src/ui/types-web3.ts` | ~430 è¡Œ Web3/Market ç±»å‹æå–ï¼Œä¸»æ–‡ä»¶ç”¨ `export type { ... } from` re-export |
| `ui/src/ui/tab-registry.ts` | `ui/src/ui/tab-registry-web3.ts` | web3/market tab å®šä¹‰æå–ï¼Œä¸»æ–‡ä»¶ç”¨ `...WEB3_TAB_ENTRIES` spread |
| `ui/src/ui/app-tab-loaders.ts` | `ui/src/ui/app-tab-loaders-web3.ts` | `loadMarket`/`loadWeb3` å‡½æ•°æå–ï¼Œä¸»æ–‡ä»¶ç”¨ re-export |
| `ui/src/ui/app-view-state.ts` | `ui/src/ui/app-view-state-web3.ts` | web3 çŠ¶æ€å±æ€§æå–ä¸º `Web3ViewState` ç±»å‹ï¼Œç”¨ `&` äº¤å‰ç±»å‹åˆå¹¶ |

### 8.3 ä¸Šæ¸¸æ–‡ä»¶çš„å˜æ›´é¢æ€»ç»“

æ¯ä¸ªä¸Šæ¸¸æ–‡ä»¶ä»…å¢åŠ  **1-2 è¡Œ import** + **1-2 è¡Œ spread/re-export/call**ï¼š

```
method-scopes.ts:       +1 import, +2 spread lines
status.scan.ts:         +1 import, +1 function call (æ›¿æ¢ ~48 è¡Œ inline code)
status.command.ts:      +1 import, +1 function call (æ›¿æ¢ ~40 è¡Œ inline code)
status.ts:              +1 import, +1 Set.has() è°ƒç”¨
share.ts:               +1 import change (åŒæ–‡ä»¶ import æ›¿æ¢)
types.ts:               +1 import block (æ›¿æ¢ ~430 è¡Œ inline types)
tab-registry.ts:        +1 import, +1 spread (æ›¿æ¢ ~35 è¡Œ inline tabs)
app-tab-loaders.ts:     +2 import, +1 re-export (æ›¿æ¢ ~23 è¡Œ inline functions)
app-view-state.ts:      +1 import, +1 & äº¤å‰ç±»å‹ (æ›¿æ¢ ~34 è¡Œ inline properties)
```

å¦‚æœä»¥ä¸Šå…¨éƒ¨æ»¡è¶³ï¼Œ`sync-upstream.sh` åˆå¹¶æ—¶æœ€å¤šåªä¼šåœ¨ import è¡Œäº§ç”Ÿæ–‡æœ¬å†²çªï¼Œä¸ä¼šæ¶‰åŠä¸šåŠ¡é€»è¾‘å†²çªã€‚
