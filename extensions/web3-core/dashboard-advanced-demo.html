<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Features Demo</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        padding: 2rem;
        background: #0d1117;
        color: #d4d4d4;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        color: #4ec9b0;
        margin-bottom: 2rem;
      }

      .section {
        background: #1e1e1e;
        padding: 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        border: 1px solid #333;
      }

      h2 {
        color: #569cd6;
        margin-top: 0;
        margin-bottom: 1.5rem;
      }

      .button-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }

      button {
        padding: 12px 24px;
        background: #0e639c;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
      }

      button:hover {
        background: #1177bb;
        transform: translateY(-1px);
      }

      button.success {
        background: #10b981;
      }

      button.success:hover {
        background: #059669;
      }

      button.error {
        background: #ef4444;
      }

      button.error:hover {
        background: #dc2626;
      }

      button.warning {
        background: #f59e0b;
      }

      button.warning:hover {
        background: #d97706;
      }

      button.p0 {
        background: #dc2626;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 2rem;
      }

      .chart-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
      }

      .chart-box {
        background: #2d2d2d;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #444;
      }

      .chart-box h3 {
        margin: 0 0 1rem 0;
        color: #4ec9b0;
        font-size: 16px;
      }

      code {
        background: #2d2d2d;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        color: #ce9178;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé® Dashboard Advanced Features Demo</h1>

      <!-- Toast Notifications -->
      <div class="section">
        <h2>üîî Toast Notifications</h2>
        <p>Elegant, non-intrusive notifications with auto-dismiss</p>

        <div class="button-group">
          <button class="success" onclick="testToast('success')">‚úÖ Success Toast</button>
          <button class="error" onclick="testToast('error')">‚ùå Error Toast</button>
          <button class="warning" onclick="testToast('warning')">‚ö†Ô∏è Warning Toast</button>
          <button onclick="testToast('info')">‚ÑπÔ∏è Info Toast</button>
          <button class="p0" onclick="testToast('p0')">üö® P0 Alert (with sound)</button>
        </div>

        <p style="margin-top: 1rem; color: #888; font-size: 14px">
          üí° Click on any toast to dismiss it early
        </p>
      </div>

      <!-- Modal Dialogs -->
      <div class="section">
        <h2>üé® Modal Dialogs</h2>
        <p>Interactive modal windows with various use cases</p>

        <div class="button-group">
          <button onclick="showCreateResourceModal()">‚ûï Create Resource</button>
          <button onclick="showEditModal()">‚úèÔ∏è Edit Resource</button>
          <button onclick="showDisputeModal()">‚öñÔ∏è File Dispute</button>
          <button onclick="showDetailModal()">üîç View Details</button>
        </div>

        <p style="margin-top: 1rem; color: #888; font-size: 14px">
          üí° Press <code>Escape</code> or click backdrop to close
        </p>
      </div>

      <!-- Charts -->
      <div class="section">
        <h2>üìä Data Visualization Charts</h2>
        <p>Interactive charts powered by Chart.js</p>

        <div class="chart-grid">
          <div class="chart-box">
            <h3>üìà Resource Usage Trend</h3>
            <div class="chart-container">
              <canvas id="chart-trend"></canvas>
            </div>
          </div>

          <div class="chart-box">
            <h3>‚öñÔ∏è Dispute Resolution Rate</h3>
            <div class="chart-container">
              <canvas id="chart-disputes"></canvas>
            </div>
          </div>

          <div class="chart-box">
            <h3>üö® Alert Frequency</h3>
            <div class="chart-container">
              <canvas id="chart-alerts"></canvas>
            </div>
          </div>

          <div class="chart-box">
            <h3>üì¶ Resource Status Distribution</h3>
            <div class="chart-container">
              <canvas id="chart-status"></canvas>
            </div>
          </div>
        </div>

        <div class="button-group" style="margin-top: 2rem">
          <button onclick="updateCharts()">üîÑ Refresh Charts</button>
          <button onclick="destroyCharts()">üóëÔ∏è Clear Charts</button>
        </div>
      </div>

      <!-- Integration Demo -->
      <div class="section">
        <h2>üéØ Complete Workflow Demo</h2>
        <p>Simulate a complete user action with all features</p>

        <div class="button-group">
          <button onclick="simulateResourceCreation()">üöÄ Simulate: Create Resource</button>
          <button onclick="simulateDisputeFlow()">‚öñÔ∏è Simulate: Dispute Flow</button>
          <button onclick="simulateAlertFlow()">üö® Simulate: Alert Handling</button>
        </div>
      </div>
    </div>

    <script src="dashboard-advanced.js"></script>
    <script>
      // ==================== Toast Tests ====================

      const messages = {
        success: [
          "Resource created successfully!",
          "Changes saved!",
          "Dispute resolved!",
          "Alert acknowledged!",
        ],
        error: [
          "Failed to connect to server",
          "Invalid resource data",
          "Permission denied",
          "Operation failed",
        ],
        warning: [
          "Resource quota nearly full",
          "Dispute deadline approaching",
          "Maintenance scheduled",
          "API rate limit reached",
        ],
        info: [
          "New resource available",
          "System update completed",
          "5 new alerts",
          "Dashboard refreshed",
        ],
        p0: [
          "CRITICAL: System overload detected!",
          "P0 ALERT: Database connection lost!",
          "URGENT: Security breach attempt!",
        ],
      };

      function testToast(type) {
        const msg = messages[type][Math.floor(Math.random() * messages[type].length)];

        if (type === "p0") {
          toast.p0Alert(msg);
        } else {
          toast[type](msg);
        }
      }

      // ==================== Modal Tests ====================

      function showCreateResourceModal() {
        modal.create(
          "create-resource",
          "‚ûï Publish New Resource",
          `
          <form id="create-form">
            <label>Resource Name *</label>
            <input type="text" name="name" placeholder="e.g., GPU Compute Instance" required />

            <label>Resource Type *</label>
            <select name="type" required>
              <option value="">Select type...</option>
              <option value="compute">Compute</option>
              <option value="storage">Storage</option>
              <option value="network">Network</option>
              <option value="data">Data</option>
            </select>

            <label>Price (tokens/hour) *</label>
            <input type="number" name="price" placeholder="e.g., 100" min="1" required />

            <label>Description</label>
            <textarea name="description" rows="4" placeholder="Describe your resource..."></textarea>

            <label>Tags</label>
            <input type="text" name="tags" placeholder="gpu, compute, high-performance" />

            <div class="modal-footer">
              <button type="button" class="modal-btn modal-btn-secondary" onclick="modal.close('create-resource')">
                Cancel
              </button>
              <button type="submit" class="modal-btn modal-btn-primary">
                üöÄ Publish Resource
              </button>
            </div>
          </form>
        `,
          {
            width: "600px",
          },
        );

        modal.open("create-resource");

        // Handle form submission
        setTimeout(() => {
          document.getElementById("create-form").addEventListener("submit", (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            toast.success(`Resource "${data.name}" published successfully!`);
            modal.close("create-resource");

            console.log("Created resource:", data);
          });
        }, 100);
      }

      function showEditModal() {
        modal.create(
          "edit-resource",
          "‚úèÔ∏è Edit Resource",
          `
          <form id="edit-form">
            <label>Resource Name</label>
            <input type="text" name="name" value="GPU Instance #42" />

            <label>Price (tokens/hour)</label>
            <input type="number" name="price" value="150" />

            <label>Status</label>
            <select name="status">
              <option value="available">Available</option>
              <option value="leased" selected>Leased</option>
              <option value="maintenance">Maintenance</option>
            </select>

            <div class="modal-footer">
              <button type="button" class="modal-btn modal-btn-secondary" onclick="modal.close('edit-resource')">
                Cancel
              </button>
              <button type="submit" class="modal-btn modal-btn-primary">
                üíæ Save Changes
              </button>
            </div>
          </form>
        `,
        );

        modal.open("edit-resource");

        setTimeout(() => {
          document.getElementById("edit-form").addEventListener("submit", (e) => {
            e.preventDefault();
            toast.success("Resource updated successfully!");
            modal.close("edit-resource");
          });
        }, 100);
      }

      function showDisputeModal() {
        modal.create(
          "file-dispute",
          "‚öñÔ∏è File Dispute",
          `
          <form id="dispute-form">
            <label>Lease ID *</label>
            <input type="text" name="leaseId" placeholder="e.g., lease-12345" required />

            <label>Dispute Reason *</label>
            <select name="reason" required>
              <option value="">Select reason...</option>
              <option value="performance">Performance Issues</option>
              <option value="availability">Availability Problems</option>
              <option value="billing">Billing Dispute</option>
              <option value="terms">Terms Violation</option>
              <option value="other">Other</option>
            </select>

            <label>Description *</label>
            <textarea name="description" rows="6" placeholder="Describe the issue in detail..." required></textarea>

            <label>Evidence (URLs or hashes)</label>
            <textarea name="evidence" rows="3" placeholder="e.g., log URLs, transaction hashes..."></textarea>

            <div class="modal-footer">
              <button type="button" class="modal-btn modal-btn-secondary" onclick="modal.close('file-dispute')">
                Cancel
              </button>
              <button type="submit" class="modal-btn modal-btn-primary">
                üì® Submit Dispute
              </button>
            </div>
          </form>
        `,
        );

        modal.open("file-dispute");

        setTimeout(() => {
          document.getElementById("dispute-form").addEventListener("submit", (e) => {
            e.preventDefault();
            toast.warning("Dispute submitted. Case ID: #DSP-" + Math.floor(Math.random() * 10000));
            modal.close("file-dispute");
          });
        }, 100);
      }

      function showDetailModal() {
        modal.create(
          "resource-detail",
          "üîç Resource Details",
          `
          <div style="line-height: 1.8;">
            <p><strong>Resource ID:</strong> <code>res-7f8a9b</code></p>
            <p><strong>Name:</strong> High-Performance GPU Instance</p>
            <p><strong>Type:</strong> <span style="background: #10b981; padding: 2px 8px; border-radius: 4px; font-size: 12px;">Compute</span></p>
            <p><strong>Owner:</strong> alice.eth</p>
            <p><strong>Price:</strong> 150 tokens/hour</p>
            <p><strong>Status:</strong> <span style="background: #3b82f6; padding: 2px 8px; border-radius: 4px; font-size: 12px;">Available</span></p>
            <p><strong>Created:</strong> 2026-02-15 10:30:00</p>
            <p><strong>Total Leases:</strong> 42</p>
            <p><strong>Rating:</strong> ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8/5.0)</p>

            <h3 style="color: #4ec9b0; margin-top: 2rem; margin-bottom: 1rem;">Description</h3>
            <p style="color: #888;">
              Professional-grade GPU compute instance with 16GB VRAM, optimized for machine learning and rendering workloads.
              99.9% uptime SLA guaranteed.
            </p>

            <h3 style="color: #4ec9b0; margin-top: 2rem; margin-bottom: 1rem;">Specifications</h3>
            <ul style="color: #888;">
              <li>GPU: NVIDIA A100 40GB</li>
              <li>CPU: 16 vCPUs</li>
              <li>RAM: 64GB DDR4</li>
              <li>Storage: 1TB NVMe SSD</li>
              <li>Network: 10Gbps</li>
            </ul>

            <div class="modal-footer">
              <button class="modal-btn modal-btn-secondary" onclick="modal.close('resource-detail')">
                Close
              </button>
              <button class="modal-btn modal-btn-primary" onclick="toast.success('Lease request sent!'); modal.close('resource-detail')">
                üöÄ Lease Now
              </button>
            </div>
          </div>
        `,
          { width: "700px" },
        );

        modal.open("resource-detail");
      }

      // ==================== Chart Tests ====================

      function initCharts() {
        // Resource Usage Trend
        chartManager.createLineChart("chart-trend", {
          labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          datasets: [
            {
              label: "Published Resources",
              data: [12, 19, 15, 25, 32, 38],
              borderColor: "#4ec9b0",
              backgroundColor: "rgba(78, 201, 176, 0.1)",
              tension: 0.4,
            },
            {
              label: "Active Leases",
              data: [8, 15, 12, 20, 28, 35],
              borderColor: "#569cd6",
              backgroundColor: "rgba(86, 156, 214, 0.1)",
              tension: 0.4,
            },
          ],
        });

        // Dispute Resolution Rate
        chartManager.createBarChart("chart-disputes", {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [
            {
              label: "Opened",
              data: [12, 15, 8, 10],
              backgroundColor: "#f59e0b",
            },
            {
              label: "Resolved",
              data: [10, 14, 7, 9],
              backgroundColor: "#10b981",
            },
          ],
        });

        // Alert Frequency
        chartManager.createBarChart("chart-alerts", {
          labels: ["P0", "P1", "P2", "Info"],
          datasets: [
            {
              label: "Alert Count",
              data: [2, 8, 15, 32],
              backgroundColor: ["#dc2626", "#f59e0b", "#3b82f6", "#888"],
            },
          ],
        });

        // Resource Status Distribution
        chartManager.createDoughnutChart("chart-status", {
          labels: ["Available", "Leased", "Maintenance", "Offline"],
          datasets: [
            {
              data: [45, 35, 12, 8],
              backgroundColor: ["#10b981", "#3b82f6", "#f59e0b", "#6b7280"],
            },
          ],
        });
      }

      function updateCharts() {
        toast.info("Refreshing chart data...");
        setTimeout(() => {
          initCharts();
          toast.success("Charts updated!");
        }, 500);
      }

      function destroyCharts() {
        chartManager.destroyAll();
        toast.info("All charts cleared");
      }

      // ==================== Workflow Simulations ====================

      async function simulateResourceCreation() {
        toast.info("Opening resource creation form...");
        await new Promise((r) => setTimeout(r, 800));

        showCreateResourceModal();
      }

      async function simulateDisputeFlow() {
        toast.info("Loading dispute case...");
        await new Promise((r) => setTimeout(r, 600));

        toast.warning("Lease #12345 reported an issue");
        await new Promise((r) => setTimeout(r, 1000));

        showDisputeModal();
      }

      async function simulateAlertFlow() {
        toast.p0Alert("CRITICAL: Database connection unstable!");
        await new Promise((r) => setTimeout(r, 1500));

        toast.warning("Investigating the issue...");
        await new Promise((r) => setTimeout(r, 2000));

        toast.success("Issue resolved. Database connection restored.");
      }

      // ==================== Initialize ====================

      window.addEventListener("load", () => {
        console.log("üé® Advanced Features Demo loaded");
        initCharts();

        // Show welcome toast
        setTimeout(() => {
          toast.success("Welcome to Dashboard Advanced Features Demo! üéâ");
        }, 500);
      });
    </script>
  </body>
</html>
