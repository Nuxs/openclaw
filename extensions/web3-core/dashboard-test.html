<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard API Test</title>
    <style>
      body {
        font-family: monospace;
        padding: 2rem;
        background: #1e1e1e;
        color: #d4d4d4;
      }
      .test-result {
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 4px;
        border-left: 4px solid #4ec9b0;
      }
      .test-result.success {
        background: #1b3a2c;
        border-color: #4ec9b0;
      }
      .test-result.error {
        background: #3a1b1b;
        border-color: #f48771;
      }
      .test-result.pending {
        background: #3a3a1b;
        border-color: #dcdcaa;
      }
      pre {
        background: #2d2d2d;
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
      }
      button {
        background: #0e639c;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        margin: 0.5rem;
      }
      button:hover {
        background: #1177bb;
      }
      h1 {
        color: #569cd6;
      }
      h2 {
        color: #4ec9b0;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Dashboard API Integration Test</h1>
    <p>Testing Web3 Core Gateway API integration with Dashboard</p>

    <div>
      <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
      <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
    </div>

    <div id="results"></div>

    <script src="dashboard-api.js"></script>
    <script>
      const api = new DashboardAPI("http://localhost:3000");
      const results = document.getElementById("results");

      function addResult(name, status, data) {
        const div = document.createElement("div");
        div.className = `test-result ${status}`;

        let statusIcon = "‚è≥";
        if (status === "success") statusIcon = "‚úÖ";
        if (status === "error") statusIcon = "‚ùå";

        div.innerHTML = `
          <h3>${statusIcon} ${name}</h3>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
        results.appendChild(div);
      }

      function clearResults() {
        results.innerHTML = "";
      }

      async function test(name, fn) {
        addResult(name, "pending", { status: "Running..." });
        try {
          const result = await fn();
          addResult(name, "success", result);
          return { name, success: true, result };
        } catch (error) {
          addResult(name, "error", {
            error: error.message,
            stack: error.stack,
          });
          return { name, success: false, error: error.message };
        }
      }

      async function runAllTests() {
        clearResults();
        console.log("üß™ Starting API Integration Tests...");

        const testResults = [];

        // Test 1: Health Check
        testResults.push(
          await test("1. Health Check", async () => {
            return await api.healthCheck();
          })
        );

        // Test 2: System Status
        testResults.push(
          await test("2. System Status", async () => {
            return await api.getSystemStatus();
          })
        );

        // Test 3: System Metrics
        testResults.push(
          await test("3. System Metrics", async () => {
            return await api.getSystemMetrics();
          })
        );

        // Test 4: Get Resources
        testResults.push(
          await test("4. Get Resources", async () => {
            return await api.getResources();
          })
        );

        // Test 5: Get Disputes
        testResults.push(
          await test("5. Get Disputes", async () => {
            return await api.getDisputes();
          })
        );

        // Test 6: Get Alerts
        testResults.push(
          await test("6. Get Alerts", async () => {
            return await api.getAlerts();
          })
        );

        // Test 7: Get Recent Activity
        testResults.push(
          await test("7. Get Recent Activity", async () => {
            return await api.getRecentActivity(10);
          })
        );

        // Test 8: Get Lease Stats
        testResults.push(
          await test("8. Get Lease Stats", async () => {
            return await api.getLeaseStats();
          })
        );

        // Test 9: Get Dispute Stats
        testResults.push(
          await test("9. Get Dispute Stats", async () => {
            return await api.getDisputeStats();
          })
        );

        // Test 10: Get Alert Stats
        testResults.push(
          await test("10. Get Alert Stats", async () => {
            return await api.getAlertStats();
          })
        );

        // Summary
        const successCount = testResults.filter((r) => r.success).length;
        const failCount = testResults.filter((r) => !r.success).length;

        addResult(
          "Test Summary",
          successCount === testResults.length ? "success" : "error",
          {
            total: testResults.length,
            passed: successCount,
            failed: failCount,
            passRate: `${((successCount / testResults.length) * 100).toFixed(1)}%`,
          }
        );

        console.log("‚úÖ Tests completed!");
        console.log(`Passed: ${successCount}/${testResults.length}`);
      }

      // Auto-run tests on load if URL has ?autorun=true
      if (window.location.search.includes("autorun=true")) {
        window.addEventListener("load", () => {
          setTimeout(runAllTests, 1000);
        });
      }
    </script>
  </body>
</html>
