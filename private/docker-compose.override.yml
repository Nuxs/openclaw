# ============================================================================
# 私有化 docker-compose override
# ============================================================================
# 用法: docker compose -f docker-compose.yml -f private/docker-compose.override.yml up
# 或设置 COMPOSE_FILE 环境变量:
#   export COMPOSE_FILE=docker-compose.yml:private/docker-compose.override.yml

services:
  openclaw-gateway:
    # 使用私有镜像
    image: ${OPENCLAW_IMAGE:-ghcr.io/your-org/openclaw:latest}
    env_file:
      - ./private/env/${DEPLOY_ENV:-dev}.env
    # 允许在 dev 环境下跳过配置守卫（由 OPENCLAW_ALLOW_UNCONFIGURED 控制）
    command: >
      sh -lc 'node dist/index.js gateway --bind "${OPENCLAW_GATEWAY_BIND:-lan}" --port 18789 ${OPENCLAW_ALLOW_UNCONFIGURED:+--allow-unconfigured}'
    # 健康检查
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:18789/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    # 资源限制（按需调整）
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: "2.0"
        reservations:
          memory: 512M
          cpus: "0.5"
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "5"

  openclaw-cli:
    image: ${OPENCLAW_IMAGE:-ghcr.io/your-org/openclaw:latest}
    env_file:
      - ./private/env/${DEPLOY_ENV:-dev}.env
