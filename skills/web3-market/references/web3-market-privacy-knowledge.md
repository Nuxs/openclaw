# Web3 Market：个人数据与私有知识的市场化规范（consent/脱敏/合规/撤销）

> 目标：把“主人愿意分享的一切（含个人数据/私有知识）”纳入 Web3 Market 的市场对象时，给 AI 管家一份**可直接执行**的安全与合规规范。
>
> 本文是规范，不等同于“代码已完全实现”。当规范与实现冲突时：优先修正实现与测试，再同步文档。

---

## 0. 核心原则（不可妥协）

1. **强同意（consent-first）**：任何个人数据/私有知识的发布、交付、二次使用，都必须有明确的同意对象（Consent），并可在审计中回放。

2. **最小披露（minimize disclosure）**：

- 对外输出默认只提供“可分享摘要”（脱敏）
- 任何可外发面（文档示例/日志/错误/状态输出/工具返回）不得包含：明文 token、Provider endpoint、真实文件路径、私钥/凭证、原始个人数据内容。

3. **可撤销（revocable-by-default）**：

- 撤销后必须对未来访问做强一致拒绝
- 撤销动作必须留下可审计证据（hash/时间/主体/原因），但不泄露内容本体。

4. **可审计（auditable）**：

- 审计事件应该记录“谁在何时以何种用途访问了什么（用引用/哈希表示）”，支持争议举证与合规回放。

---

## 1. 数据分类与市场对象映射

### 1.1 数据分类（用于 AI 决策）

- **P0（严禁外发）**：身份证件号、银行卡号、精确定位、私钥/助记词、原始聊天记录全文、可识别的健康/财务明细、任何未脱敏的私密内容。
- **P1（强同意 + 强脱敏 + 强撤销）**：个人文档/笔记、私有知识库、私有邮件摘要、家庭/组织内部流程、工作代码片段（若含敏感信息需再分级）。
- **P2（可分享摘要）**：在 P1 上做足够脱敏后的摘要/统计/对账信息；可复制粘贴传播。

### 1.2 市场对象（面向协议与实现对齐）

- **交易/结算市场（B-1）**：把“个人数据/私有知识”视作可交付资产：Offer → Order → Consent → Delivery → Settlement。
- **资源共享市场（B-2）**：当个人知识以“服务形态”被提供（例如：一个私有检索服务/私有向量库检索），仍应通过 Resource/Lease/Ledger 执行访问控制与记账。

---

## 2. Consent（同意）规范

### 2.1 Consent 必备字段（规范要求）

Consent 必须能回答以下问题（并可在审计中回放）：

- **主体**：谁授权（owner/buyer）→ 谁使用（agent/provider）
- **对象**：授权的是哪一份数据/知识（用 `assetId`/`deliveryId`/`contentRefHash` 表示）
- **目的**：用途（purpose）必须明确，例如："summarize" / "classify" / "answer_questions" / "train"（训练默认禁止）
- **范围**：数据范围（scope）与允许的字段/片段级限制（field-level / section-level）
- **期限**：有效期（durationDays 或 expiresAt）
- **再分发**：是否允许再分发/转授（默认不允许）
- **日志策略**：允许记录哪些审计字段（默认仅 hash+统计，不记录原文）

### 2.2 强制决策点（AI 必须询问）

当资源类型属于 P1/P0 时，AI 在执行前必须确认：

- 是否允许将数据交付给第三方 Provider（默认：不允许；仅允许本地/受信域）
- 是否允许“持久化存储”（默认：不允许；只允许临时处理或加密外部存储）
- 是否允许用于训练/微调（默认：禁止）

---

## 3. 脱敏（redaction）与可分享输出

### 3.1 输出分级

- **对话/状态/工具输出（外发面）**：仅允许 P2（可分享摘要）。
- **内部审计事件**：允许记录结构化元数据 + hash（不包含明文内容）。

### 3.2 推荐脱敏策略（AI 可执行）

- **标识符替换**：姓名/电话/邮箱/地址 → `[REDACTED_*]`
- **范围模糊**：精确金额/地址 → 区间或哈希引用
- **内容摘要**：用要点列表替代原文；保留可追溯 hash
- **最小必要引用**：用 `contentRefHash` 指向内容，不在输出中携带内容

### 3.3 可分享对账摘要（ReconciliationSummary）最低字段集合

摘要必须可复制粘贴传播，且不包含敏感字段：

- 时间范围（start/end）
- 参与方（providerActorId 等，可用脱敏 ID）
- 使用类型（kind：model/search/storage/private_knowledge）
- 用量（usage 汇总：tokens/queries/gb_day 等）
- 费用汇总（amount/currency，必要时可包含 FXQuote 引用）
- 争议状态汇总（disputes: counts by status）
- 证据引用（evidenceRefs：hash 列表）

---

## 4. 撤销（revocation）规范

### 4.1 触发条件

- owner/buyer 主动撤销 consent
- 到期自动撤销（expiresAt）
- 争议裁决导致撤销

### 4.2 强一致拒绝（必须做到）

撤销后，对未来访问必须满足：

- Provider/路由层拒绝（在鉴权阶段拒绝，不依赖“后续记账失败”）
- 任何缓存的 token/会话路由必须失效

### 4.3 撤销证据

撤销事件必须留下：

- `revocationId`、`actorId`、`reason`、`at`
- 关联对象引用：`consentId`/`deliveryId`/`assetId`（不带明文内容）

---

## 5. 合规与回放（compliance replay）

- **可证明**：能证明“同意存在、用途匹配、访问发生、撤销可追溯”。
- **不泄露**：回放只展示结构化元数据与 hash 引用；内容本体按授权再解密/检索。
- **默认最小化**：没有明确授权，不进行跨会话长期保留；需要保留时必须加密并可轮换密钥。

---

## 6. 与现有 Web3/Market 口径的对齐点

- `web3.*` 是对外入口，`market.*` 是内部权威。
- 任何 token/endpoint/真实路径都不得进入可外发面。
- 个人数据/私有知识进入市场后，优先走“交易/结算市场（Offer/Order/Consent/Delivery/Settlement）”语义；如果以服务形态共享，再落到“资源共享市场（Resource/Lease/Ledger）”。

---

## 7. AI 管家执行清单（最短路径）

1. 判定数据等级（P0/P1/P2）。
2. 若为 P0：拒绝外发；只允许本地处理或输出 P2 摘要。
3. 若为 P1：要求显式 consent（目的/范围/期限/再分发/持久化）。
4. 生成交付与审计引用（hash/ref），不输出内容本体。
5. 任何对外输出只给 P2 摘要。
6. 发生撤销/到期/裁决：立即使未来访问强一致拒绝，并记录撤销证据。
